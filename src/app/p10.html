<!DOCTYPE html>
<html>

<head>
    <title>ë¬¸ì œ í’€ê¸°</title>
    <link rel="stylesheet" type="text/css" href="../style/styles.css">
    <style>
     

        input[type='checkbox'] {
            display: none;
        }

        label {
            display: block;
            position: relative;
            padding-left: 35px;
            margin-bottom: 10px;
            cursor: pointer;
        }

        label:before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 25px;
            height: 25px;
            border: 1px solid #000;
        }

        input[type='checkbox']:checked+label:before {
            content: 'âœ”';
            text-align: center;
            line-height: 25px;
            font-size: 20px;
        }
    </style>
    <script>
        async function fetchQuestionsAndHandle() {
            const response = await fetch('./json/QUESTIONS10.json'); 
            const data = await response.json();

            let questions = data;
            let checkedChoices = []; 
            let solvedQuestions = 0;

            function displayQuestion(index) {
                let question = questions[index];

                document.getElementById('question').innerText = `ë¬¸ì œ ${question['ë¬¸ì œë²ˆí˜¸']}: ${question['ë¬¸ì œ']}`;

                let choices = question['ì„ íƒì§€'];
                let choiceList = document.getElementById('choices');
                choiceList.innerHTML = '';
                if (!Array.isArray(choices)) {
                    choices = choices.split(','); 
                }

                choices.forEach((choice, idx) => {
                    let listItem = document.createElement('li');
                    let checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `choice${idx}`;
                    checkbox.name = 'answer';
                    checkbox.value = choice;
                    let label = document.createElement('label');
                    label.htmlFor = `choice${idx}`;
                    label.appendChild(document.createTextNode(choice));
                    listItem.appendChild(checkbox);
                    listItem.appendChild(label);
                    choiceList.appendChild(listItem);

                    checkbox.addEventListener('change', function () {
                        if (this.checked) {
                            let otherCheckboxes = document.querySelectorAll('input[name="answer"]');
                            otherCheckboxes.forEach(cb => {
                                if (cb !== this) {
                                    cb.checked = false;
                                }
                            });
                            solvedQuestions++;
                            updateQuestionStatus(solvedQuestions);
                        }
                    });
                });
            }

            function checkAnswer(index) {
                let question = questions[index];
                let choices = question['ì„ íƒì§€'];
                let checked = [];

                choices.forEach((choice, idx) => {
                    let checkbox = document.getElementById(`choice${idx}`);
                    if (checkbox.checked) {
                        checked.push(choice);
                    }
                });

                let answer = document.getElementById('answer');
                if (checked.length === 0) {
                    answer.innerText = question['ì •ë‹µ']; 
                    checkedChoices[index] = []; 
                    return;
                }

                if (JSON.stringify(checked) === JSON.stringify([question['ì •ë‹µ']])) {
                    answer.innerText = 'âœ… ì •ë‹µì…ë‹ˆë‹¤!';
                } else {
                    answer.innerText = `âŒ í‹€ë ¸ìŠµë‹ˆë‹¤. ì •ë‹µì€ ${question['ì •ë‹µ']}ì…ë‹ˆë‹¤.`;
                }

                checkedChoices[index] = checked; 
            }

            function updateQuestionStatus(solved) {
                let remainingQuestions = questions.length - solved;
                document.getElementById('solvedQuestions').innerText = `í‘¼ ë¬¸ì œ: ${solved}`;
                document.getElementById('remainingQuestions').innerText = `ë‚¨ì€ ë¬¸ì œ: ${remainingQuestions}`;
            }

            document.getElementById('submit').addEventListener('click', function () {
                if (currentIndex === questions.length - 1) {
                    let isUnchecked = Array.from(document.querySelectorAll('input[name="answer"]')).every(input => !input.checked);
                    if (isUnchecked) {
                        document.getElementById('answer').innerText = 'í•˜ë‚˜ ì´ìƒì˜ ì„ íƒì§€ë¥¼ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.';
                        return;
                    }
                }
                checkAnswer(currentIndex);
            });

            let currentIndex = 0;
            displayQuestion(currentIndex);
            updateQuestionStatus(solvedQuestions);

            document.getElementById('next').addEventListener('click', function () {
                currentIndex++;
                if (currentIndex < questions.length) {
                    displayQuestion(currentIndex);
                    document.getElementById('answer').innerText = ''; 
                    document.getElementById('result').innerText = ''; 
                } else {
                    alert('ğŸ¸ ë” ì´ìƒ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
            });

            document.getElementById('submit').addEventListener('click', function () {
                checkAnswer(currentIndex);
                if (currentIndex === questions.length - 1) {
                    let correctCount = checkedChoices.filter(choices => JSON.stringify(choices) === JSON.stringify([questions[checkedChoices.indexOf(choices)].ì •ë‹µ])).length;
                    let wrongCount = questions.length - correctCount;

                    let result = document.getElementById('result');
                    result.innerText = `ğŸ˜Š ì •ë‹µ ìˆ˜: ${correctCount}, ğŸ˜¢ í‹€ë¦° ìˆ˜: ${wrongCount}`;

                    let wrongQuestions = checkedChoices.map((choices, idx) => {
                        if (JSON.stringify(choices) !== JSON.stringify([questions[idx].ì •ë‹µ])) {
                            return questions[idx].ë¬¸ì œë²ˆí˜¸;
                        }
                    }).filter(Boolean);

                    if (wrongQuestions.length > 0) {
                        result.innerText += `\nâœ” í‹€ë¦° ë¬¸ì œ ë²ˆí˜¸: ${wrongQuestions.join(', ')}`;
                    }
                }
            });

            document.getElementById('prev').addEventListener('click', function () {
                if (currentIndex > 0) {
                    currentIndex--;
                    displayQuestion(currentIndex);
                    document.getElementById('answer').innerText = ''; 
                    document.getElementById('result').innerText = ''; 
                } else {
                    alert('ğŸ¸ ì²« ë²ˆì§¸ ë¬¸ì œì…ë‹ˆë‹¤.');
                }
            });

            document.addEventListener('DOMContentLoaded', () => {
                fetchQuestionsAndHandle();
                document.getElementById('prev').disabled = true; 
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchQuestionsAndHandle();
        });
    </script>
</head>

<body>
    <div class="container">
        <h1 id="question"></h1>
        <ul id="choices"></ul>
        <div id="buttonContainer">
            <button id="prev">â¬… ì´ì „ ë¬¸ì œ</button>
            <button id="submit">â˜‘ í™•ì¸</button>
            <button id="next">â¡ ë‹¤ìŒ ë¬¸ì œ</button>
        </div>
        <p id="answer"></p>
        <div class="result" id="result"></div>
        <div id="questionStatus">
            <p id="solvedQuestions">í‘¼ ë¬¸ì œ: 0</p>
            <p id="remainingQuestions">ğŸ“‘ ë‚¨ì€ ë¬¸ì œ: 0</p>
        </div>
    </div>
</body>

</html>